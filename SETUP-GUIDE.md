# 🚀 CRM PostgreSQL System - Complete Setup Guide

## 📋 Quick Start (Recommended)

### 1. One-Command Installation
```bash
# Install all prerequisites automatically
curl -fsSL https://raw.githubusercontent.com/mcatania72/CRM-PostgreSQL-System/main/scripts/install-prerequisites.sh | bash
```

### 2. Clone and Setup
```bash
# Clone the repository
git clone https://github.com/mcatania72/CRM-PostgreSQL-System.git
cd CRM-PostgreSQL-System

# Setup environment (creates all .env files automatically)
./scripts/setup-environment.sh

# Start the application
docker-compose up -d
```

### 3. Access the Application
- **Frontend**: http://localhost:4000
- **Backend API**: http://localhost:4001/api
- **Database Admin**: http://localhost:4003 (Adminer)
- **API Documentation**: http://localhost:4001/api/docs

### 4. Default Login
- **Email**: admin@crm.local
- **Password**: admin123

---

## 📚 Detailed Setup Instructions

### Step 1: Prerequisites Installation

#### Automated Installation (Recommended)
```bash
# Download and run prerequisites installer
curl -fsSL https://raw.githubusercontent.com/mcatania72/CRM-PostgreSQL-System/main/scripts/install-prerequisites.sh | bash

# If you prefer to inspect the script first:
wget https://raw.githubusercontent.com/mcatania72/CRM-PostgreSQL-System/main/scripts/install-prerequisites.sh
chmod +x install-prerequisites.sh
./install-prerequisites.sh
```

#### What Gets Installed:
- ✅ Node.js 20.x with npm
- ✅ Docker and Docker Compose
- ✅ Git and essential utilities
- ✅ PostgreSQL client tools
- ✅ Firewall configuration (UFW)
- ✅ System updates and security patches

#### Manual Prerequisites (if needed):
See [PREREQUISITES.md](PREREQUISITES.md) for manual installation instructions.

### Step 2: Download the Project

```bash
# Clone the repository
git clone https://github.com/mcatania72/CRM-PostgreSQL-System.git
cd CRM-PostgreSQL-System

# Verify project structure
tree -L 2
```

**Expected structure:**
```
.
├── backend/
├── frontend/
├── scripts/
├── docs/
├── docker-compose.yml
├── README.md
└── SETUP-GUIDE.md
```

### Step 3: Environment Configuration

#### Automated Setup (Recommended)
```bash
# Generate all .env files with secure secrets
./scripts/setup-environment.sh
```

#### What Gets Created:
- ✅ `backend/.env` - Backend configuration with secure JWT secrets
- ✅ `frontend/.env` - Frontend configuration
- ✅ `.env` - Docker configuration
- ✅ `*.env.example` - Template files for sharing
- ✅ Required directories (logs, uploads, backups)
- ✅ Updated .gitignore

#### Manual Configuration (if needed):
```bash
# Copy example files
cp backend/.env.example backend/.env
cp frontend/.env.example frontend/.env
cp .env.example .env

# Edit configurations
nano backend/.env
nano frontend/.env
nano .env
```

### Step 4: Application Deployment

#### Docker Deployment (Recommended)
```bash
# Start all services
docker-compose up -d

# Check service status
docker-compose ps

# View logs
docker-compose logs -f
```

#### Manual NPM Deployment
```bash
# Start PostgreSQL only
docker-compose up -d postgres

# Backend setup
cd backend
npm install
npm run build
npm run db:seed  # Populate with sample data
npm run dev     # Port 4001

# Frontend setup (new terminal)
cd frontend
npm install
npm run dev     # Port 4000
```

### Step 5: Verification and Testing

#### Health Checks
```bash
# Backend API
curl http://localhost:4001/api/health
# Expected: {"status":"ok","database":"connected"}

# Frontend
curl -I http://localhost:4000
# Expected: HTTP/1.1 200 OK

# Database
docker exec crm-postgres pg_isready -U crm_user -d crm_db
# Expected: accepting connections
```

#### API Testing
```bash
# Login test
curl -X POST http://localhost:4001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@crm.local","password":"admin123"}'

# Get customers (use token from login)
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:4001/api/customers
```

#### Frontend Testing
```bash
# Open in browser
firefox http://localhost:4000
# Or
google-chrome http://localhost:4000

# Login with default credentials:
# Email: admin@crm.local
# Password: admin123
```

---

## 🔧 Configuration Details

### Port Configuration
| Service | Port | Description |
|---------|------|-------------|
| Frontend | 4000 | React application |
| Backend | 4001 | Node.js API server |
| PostgreSQL | 4002 | Database server |
| Adminer | 4003 | Database web interface |
| Grafana | 4004 | Monitoring (optional) |
| Prometheus | 4005 | Metrics (optional) |

### Environment Variables

#### Backend (.env)
```env
# Database
DB_HOST=localhost
DB_PORT=4002
DB_USERNAME=crm_user
DB_PASSWORD=<auto-generated>
DB_DATABASE=crm_db

# Security
JWT_SECRET=<auto-generated-64-chars>
JWT_EXPIRES_IN=24h
SESSION_SECRET=<auto-generated>

# Server
PORT=4001
NODE_ENV=development
```

#### Frontend (.env)
```env
# API Configuration
VITE_API_URL=http://localhost:4001/api
VITE_APP_NAME=CRM PostgreSQL System
VITE_APP_VERSION=2.0.0

# Features
VITE_ENABLE_DEBUG=true
VITE_DEFAULT_THEME=light
```

#### Docker (.env)
```env
# Project
PROJECT_NAME=crm-postgresql-system
COMPOSE_PROJECT_NAME=crm-postgres

# Ports
FRONTEND_PORT=4000
BACKEND_PORT=4001
POSTGRES_PORT=4002

# Database
POSTGRES_DB=crm_db
POSTGRES_USER=crm_user
POSTGRES_PASSWORD=<auto-generated>
```

---

## 🐳 Docker Services

### Service Overview
```yaml
services:
  postgres:     # PostgreSQL 15 database
  backend:      # Node.js API server
  frontend:     # React application (Nginx)
  adminer:      # Database administration
```

### Volume Mounts
- `postgres_data`: PostgreSQL data persistence
- `uploads_data`: File uploads storage
- `logs_data`: Application logs

### Networks
- `crm_network`: Internal communication
- Bridge network for external access

---

## 🧪 Development Setup

### Hot Reload Development
```bash
# Start database only
docker-compose up -d postgres adminer

# Backend development
cd backend
npm install
npm run dev  # Watches for changes

# Frontend development (new terminal)
cd frontend
npm install
npm run dev  # Vite hot reload
```

### Database Management
```bash
# Access database directly
docker exec -it crm-postgres psql -U crm_user -d crm_db

# Run migrations
cd backend
npm run migration:run

# Seed database
npm run db:seed

# Backup database
docker exec crm-postgres pg_dump -U crm_user crm_db > backup.sql

# Restore database
docker exec -i crm-postgres psql -U crm_user crm_db < backup.sql
```

### Code Quality
```bash
# Backend tests
cd backend
npm test
npm run test:coverage
npm run lint
npm run format

# Frontend tests
cd frontend
npm test
npm run test:coverage
npm run lint
npm run format
```

---

## 🚨 Troubleshooting

### Common Issues

**1. Ports Already in Use**
```bash
# Check what's using the ports
sudo netstat -tlnp | grep -E ":(4000|4001|4002)"

# Stop conflicting services
sudo systemctl stop apache2  # If using port 4000
sudo systemctl stop postgresql  # If using port 4002
```

**2. Docker Permission Denied**
```bash
# Add user to docker group and restart session
sudo usermod -aG docker $USER
newgrp docker
# Or logout and login again
```

**3. Database Connection Failed**
```bash
# Check PostgreSQL container
docker-compose logs postgres

# Restart database
docker-compose restart postgres

# Reset database
docker-compose down
docker volume rm crm-postgres_postgres_data
docker-compose up -d postgres
```

**4. Build Failures**
```bash
# Clear npm cache
cd backend && npm cache clean --force
cd frontend && npm cache clean --force

# Reinstall dependencies
rm -rf node_modules package-lock.json
npm install

# Rebuild containers
docker-compose build --no-cache
```

**5. Environment Issues**
```bash
# Regenerate environment files
./scripts/setup-environment.sh

# Check environment variables
cd backend && npm run env:check
cd frontend && npm run env:check
```

### Log Files
- Prerequisites: `~/crm-postgres-install.log`
- Setup: `~/crm-postgres-setup.log`
- Backend: `backend/logs/backend.log`
- Frontend: `frontend/logs/vite.log`
- Docker: `docker-compose logs`

### Reset Everything
```bash
# Complete reset
docker-compose down
docker system prune -f
docker volume prune -f
rm -rf backend/.env frontend/.env .env
rm -rf backend/node_modules frontend/node_modules
rm -rf backend/logs frontend/logs logs

# Start fresh
./scripts/setup-environment.sh
docker-compose up -d
```

---

## ✅ Success Criteria

Setup is successful when:

- ✅ All prerequisites installed without errors
- ✅ All .env files generated with secure secrets
- ✅ Docker containers start and remain healthy
- ✅ Frontend accessible at http://localhost:4000
- ✅ Backend API responds at http://localhost:4001/api/health
- ✅ Database connections work
- ✅ Login works with admin@crm.local/admin123
- ✅ CRUD operations function correctly
- ✅ No critical errors in logs

---

## 📞 Support

For help and support:

1. **Check logs**: Review the log files for error messages
2. **Verify prerequisites**: Ensure all requirements are met
3. **Try troubleshooting**: Follow the troubleshooting guide
4. **Reset and retry**: Use the reset commands if needed
5. **Create issue**: Submit a GitHub issue with log files

---

## 🎯 Next Steps

After successful setup:

1. **Explore the application**: Test all CRM features
2. **Customize configuration**: Adjust settings for your needs
3. **Add data**: Import your customer data
4. **Setup monitoring**: Enable Grafana and Prometheus
5. **Deploy to production**: Follow the production deployment guide

---

**🎉 Welcome to CRM PostgreSQL System!**